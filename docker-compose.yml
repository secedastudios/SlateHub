# Default Docker Compose configuration
# For development, use: docker-compose -f docker-compose.dev.yml up
# For production, use: docker-compose -f docker-compose.prod.yml up

services:
    slatehub:
        build:
            context: ./server
            dockerfile: Dockerfile
        container_name: slatehub-server
        ports:
            - "3000:3000"
        environment:
            # Server configuration
            SERVER_HOST: 0.0.0.0
            SERVER_PORT: 3000

            # Database configuration
            DB_HOST: surrealdb
            DB_PORT: 8000
            DB_USERNAME: root
            DB_PASSWORD: root
            DB_NAMESPACE: slatehub
            DB_NAME: main

            # S3/MinIO configuration
            S3_ENDPOINT: http://minio:9000
            S3_REGION: us-east-1
            S3_ACCESS_KEY_ID: slatehub
            S3_SECRET_ACCESS_KEY: slatehub123
            S3_BUCKET: slatehub

            # Logging
            RUST_LOG: info
            LOG_FORMAT: pretty
        depends_on:
            - surrealdb
            - minio
        networks:
            - slatehub-network
        restart: unless-stopped

    surrealdb:
        image: surrealdb/surrealdb:latest
        container_name: slatehub-surrealdb
        user: "${UID:-1000}"
        ports:
            - "8000:8000"
        volumes:
            - ./db/data:/data
        command: start --log info --user root --pass root rocksdb://data/database.db
        environment:
            SURREAL_LOG: info
        networks:
            - slatehub-network
        restart: unless-stopped

    minio:
        image: minio/minio:latest
        container_name: slatehub-minio
        ports:
            - "9000:9000" # MinIO API
            - "9001:9001" # MinIO Console
        volumes:
            - ./db/files:/data
        environment:
            MINIO_ROOT_USER: slatehub
            MINIO_ROOT_PASSWORD: slatehub123
            MINIO_CONSOLE_ADDRESS: :9001
        command: server /data --console-address ":9001"
        networks:
            - slatehub-network
        restart: unless-stopped

volumes:
    surrealdb-data:
        driver: local
    minio-data:
        driver: local

networks:
    slatehub-network:
        driver: bridge
