{% extends "_layout.html" %}
{% block title %}
    Edit
    {{ organization.name }}
    - SlateHub
{% endblock %}
{% block head %}
    <link rel="stylesheet" href="/static/css/components/image-upload.css" />
{% endblock %}
{% block content %}
    <main id="main-content" data-page="edit-organization">
        <header>
            <h1 id="heading-edit-organization">Edit Organization</h1>
            <p>Update your organization's information</p>
        </header>
        {% if error.is_some() %}
            <div id="error-form" role="alert" data-state="error">
                <p>{{ error.as_ref().unwrap() }}</p>
            </div>
        {% endif %}
        <section data-component="auth-form" data-type="edit-organization">
            <form id="form-edit-organization" method="post" action="/orgs/{{ organization.slug }}/edit">
                <fieldset data-role="form-section" data-section="basic-info">
                    <legend>Basic Information</legend>
                    <div data-field="name">
                        <label for="input-name">Organization Name</label>
                        <input
                        id="input-name"
                        name="name"
                        type="text"
                        required
                        value="{{ organization.name }}"
                        placeholder="Acme Productions"
                        aria-describedby="help-name"
                    />
                        <small id="help-name">The official name of your organization</small>
                    </div>
                    <div data-field="org_type">
                        <label for="select-org-type">Organization Type</label>
                        <select id="select-org-type" name="org_type" required>
                            <option value="">Select type...</option>
                            {% for org_type in org_types %}
                                <option value="{{ org_type.id }}" {% if org_type.id.to_string() == organization.org_type.id.to_string() %}selected{% endif %}>{{ org_type.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div data-field="description">
                        <label for="textarea-description">Description</label>
                        <textarea
                        id="textarea-description"
                        name="description"
                        rows="4"
                        placeholder="Tell us about your organization..."
                        aria-describedby="help-description"
                    >
                            {% if organization.description.is_some() %}
                                {{ organization.description.as_ref().unwrap() }}
                            {% endif %}
                        </textarea>
                        <small id="help-description">
                            A brief description of what your organization does
                        </small>
                    </div>
                </fieldset>
                <fieldset data-role="form-section" data-section="logo">
                    <legend>Organization Logo</legend>
                    <div data-field="logo-upload">
                        <div id="current-logo-container" data-role="current-logo">
                            {% if organization.logo.is_some() %}
                                <div data-role="logo-preview">
                                    <img
                                id="organization-logo-current"
                                src="{{ organization.logo.as_ref().unwrap() }}"
                                alt="{{ organization.name }} logo"
                                data-organization-logo
                            />
                                    <p data-role="help-text">Current logo</p>
                                </div>
                            {% endif %}
                        </div>
                        <div id="organization-logo-upload" data-component="image-upload" data-state="ready">
                            <!-- Logo upload component will be initialized here -->
                        </div>
                        <small id="help-logo" data-role="help-text">
                            Recommended: Square image, at least 400x400 pixels.
                            Supports JPG, PNG, WebP, and SVG formats.
                        </small>
                    </div>
                </fieldset>
                <fieldset data-role="form-section" data-section="contact-info">
                    <legend>Contact Information</legend>
                    <div data-field="location">
                        <label for="input-location">Location</label>
                        <input
                        id="input-location"
                        name="location"
                        type="text"
                        value="{% if organization.location.is_some() %}{{ organization.location.as_ref().unwrap() }}{% endif %}"
                        placeholder="Los Angeles, CA"
                        aria-describedby="help-location"
                    />
                        <small id="help-location">City and state/country</small>
                    </div>
                    <div data-field="website">
                        <label for="input-website">Website</label>
                        <input
                        id="input-website"
                        name="website"
                        type="url"
                        value="{% if organization.website.is_some() %}{{ organization.website.as_ref().unwrap() }}{% endif %}"
                        placeholder="https://example.com"
                        aria-describedby="help-website"
                    />
                        <small id="help-website">Your organization's website URL</small>
                    </div>
                    <div data-field="contact_email">
                        <label for="input-contact-email">Contact Email</label>
                        <input
                        id="input-contact-email"
                        name="contact_email"
                        type="email"
                        value="{% if organization.contact_email.is_some() %}{{ organization.contact_email.as_ref().unwrap() }}{% endif %}"
                        placeholder="contact@example.com"
                        aria-describedby="help-contact-email"
                    />
                        <small id="help-contact-email">Public contact email for inquiries</small>
                    </div>
                    <div data-field="phone">
                        <label for="input-phone">Phone Number</label>
                        <input
                        id="input-phone"
                        name="phone"
                        type="tel"
                        value="{% if organization.phone.is_some() %}{{ organization.phone.as_ref().unwrap() }}{% endif %}"
                        placeholder="+1 (555) 123-4567"
                    />
                    </div>
                </fieldset>
                <fieldset data-role="form-section" data-section="additional-info">
                    <legend>Additional Information</legend>
                    <div data-field="services">
                        <label for="input-services">Services</label>
                        <input
                        id="input-services"
                        name="services"
                        type="text"
                        value="{% for service in organization.services %}{{ service }}{% if !loop.last %}, {% endif %}{% endfor %}"
                        placeholder="VFX, Post-Production, Color Grading"
                        aria-describedby="help-services"
                    />
                        <small id="help-services">
                            Comma-separated list of services your organization provides
                        </small>
                    </div>
                    <div data-field="founded_year">
                        <label for="input-founded-year">Founded Year</label>
                        <input
                        id="input-founded-year"
                        name="founded_year"
                        type="number"
                        min="1900"
                        max="2024"
                        value="{% if organization.founded_year.is_some() %}{{ organization.founded_year.unwrap() }}{% endif %}"
                        placeholder="2020"
                    />
                    </div>
                    <div data-field="employees_count">
                        <label for="input-employees-count">Number of Employees</label>
                        <input
                        id="input-employees-count"
                        name="employees_count"
                        type="number"
                        min="1"
                        value="{% if organization.employees_count.is_some() %}{{ organization.employees_count.unwrap() }}{% endif %}"
                        placeholder="10"
                        aria-describedby="help-employees"
                    />
                        <small id="help-employees">Approximate number of employees</small>
                    </div>
                    <div data-field="public">
                        <label for="input-public">
                            <input
                            id="input-public"
                            name="public"
                            type="checkbox"
                            value="on"
                            {% if organization.public %}checked{% endif %}
                        />
                            Make organization profile public
                        </label>
                        <small id="help-public">
                            If checked, anyone can view your organization's
                            profile.
                                                    If unchecked, only members
                            can view it.
                        </small>
                    </div>
                </fieldset>
                <div data-role="form-actions">
                    <button type="submit" data-type="primary">Save Changes</button>
                    <a href="/orgs/{{ organization.slug }}" role="button" data-type="secondary">Cancel</a>
                </div>
            </form>
        </section>
        <section data-section="danger-zone">
            <header data-role="section-header">
                <h2 id="heading-danger">Danger Zone</h2>
            </header>
            <div data-role="danger-actions">
                <p>
                    Once you delete an organization, there is no going back. Please be certain.
                </p>
                <form id="form-delete-org" method="post" action="/orgs/{{ organization.slug }}/delete" data-inline="true">
                    <button type="submit" data-type="danger" data-confirm="Are you sure you want to delete this organization? This action cannot be undone.">Delete Organization</button>
                </form>
            </div>
        </section>
    </main>
    <script src="/static/js/organization-logo-upload.js"></script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle delete confirmation
    const deleteForm = document.getElementById('form-delete-org');
    if (deleteForm) {
        deleteForm.addEventListener('submit', function(e) {
            const confirmBtn = e.submitter || e.target.querySelector('button[type="submit"]');
            const message = confirmBtn.dataset.confirm;
            if (message && !confirm(message)) {
                e.preventDefault();
            }
        });
    }

    // Initialize logo uploader if container exists
    const logoUploadContainer = document.getElementById('organization-logo-upload');
    if (logoUploadContainer) {
        const orgSlug = '{{ organization.slug }}';
        new OrganizationLogoUploader('organization-logo-upload', orgSlug);
    }
});
</script>
{% endblock %}
