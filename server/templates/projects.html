{% extends "_layout.html" %}
{% block title %}Projects - {{ app_name }}{% endblock %}
{% block page_name %}projects{% endblock %}
{% block content %}
<section id="projects-main" data-component="projects-page">
    <header id="projects-header" data-role="page-header">
        <h1 id="heading-projects">Projects</h1>
        <p data-role="subtitle">
            Discover film and media projects seeking collaborators
        </p>
    </header>

    <section id="section-controls" data-section="controls">
        <div id="projects-search" data-component="search-bar">
            <form
                id="form-search-projects"
                method="get"
                action="/projects"
                data-component="form"
            >
                <fieldset id="fieldset-search" data-role="search-section">
                    <legend hidden>Search Projects</legend>

                    <div id="field-search" data-field="search">
                        <label for="input-search" hidden>Search projects</label>
                        <input
                            type="search"
                            id="input-search"
                            name="filter"
                            placeholder="Search projects by title, description, or tags..."
                            value="{% if filter.is_some() %}{{ filter.as_ref().unwrap() }}{% endif %}"
                            aria-label="Search projects"
                            aria-describedby="help-search"
                        />
                        <small id="help-search" data-role="help-text" hidden>
                            Enter keywords to search for projects
                        </small>
                    </div>

                    <button
                        type="submit"
                        id="button-search"
                        data-type="primary"
                    >
                        <span data-role="button-text">Search</span>
                    </button>
                </fieldset>
            </form>
        </div>

        <div id="projects-sort" data-component="sort-controls">
            <div id="field-sort" data-field="sort">
                <label for="select-sort">Sort by:</label>
                <select
                    id="select-sort"
                    name="sort"
                    onchange="updateSort(this.value)"
                    aria-label="Sort projects"
                    aria-describedby="help-sort"
                >
                    <option value="recent" {% if sort_by == "recent" %}selected{% endif %}>
                        Most Recent
                    </option>
                    <option value="title" {% if sort_by == "title" %}selected{% endif %}>
                        Title
                    </option>
                    <option value="status" {% if sort_by == "status" %}selected{% endif %}>
                        Status
                    </option>
                </select>
                <small id="help-sort" data-role="help-text" hidden>
                    Choose how to order the project list
                </small>
            </div>
        </div>
    </section>

    <section
        id="section-projects-list"
        data-section="projects-list"
        data-layout="grid"
        data-state="{% if projects.is_empty() %}empty{% else %}ready{% endif %}"
        aria-labelledby="heading-projects"
    >
        {% if !projects.is_empty() %}
        <h2 id="heading-projects-results" hidden>Project Results</h2>
        <div id="projects-container" data-role="content-container">
            {% for project in projects %}
            <article
                id="project-{{ project.id }}"
                data-component="project-card"
                data-status="{{ project.status }}"
                data-project-id="{{ project.id }}"
            >
                <header data-role="card-header">
                    <h3 id="project-title-{{ project.id }}">
                        <a
                            href="/projects/{{ project.id }}"
                            id="link-project-{{ project.id }}"
                        >
                            {{ project.title }}
                        </a>
                    </h3>
                    <span
                        id="project-status-{{ project.id }}"
                        data-role="status-badge"
                        data-status="{{ project.status }}"
                    >
                        {{ project.status }}
                    </span>
                </header>

                <div data-role="card-body">
                    <p
                        id="project-description-{{ project.id }}"
                        data-role="description"
                    >
                        {{ project.description }}
                    </p>

                    <dl
                        id="project-metadata-{{ project.id }}"
                        data-role="metadata"
                    >
                        <dt id="label-owner-{{ project.id }}">Owner</dt>
                        <dd
                            id="project-owner-{{ project.id }}"
                            data-field="owner"
                        >
                            {{ project.owner }}
                        </dd>

                        <dt id="label-created-{{ project.id }}">Created</dt>
                        <dd
                            id="project-created-{{ project.id }}"
                            data-field="created-date"
                        >
                            <time datetime="{{ project.created_at }}">
                                {{ project.created_at }}
                            </time>
                        </dd>
                    </dl>

                    {% if !project.tags.is_empty() %}
                    <nav
                        id="project-tags-{{ project.id }}"
                        data-role="tags-list"
                        aria-label="Project tags"
                    >
                        <ul data-role="tag-list">
                            {% for tag in project.tags %}
                            <li
                                id="tag-{{ project.id }}-{{ loop.index }}"
                                data-role="tag"
                                data-tag="{{ tag }}"
                            >
                                {{ tag }}
                            </li>
                            {% endfor %}
                        </ul>
                    </nav>
                    {% endif %}
                </div>

                <footer data-role="card-footer">
                    <nav
                        id="project-actions-{{ project.id }}"
                        data-role="card-actions"
                        aria-label="Project actions"
                    >
                        <a
                            href="/projects/{{ project.id }}"
                            id="button-view-project-{{ project.id }}"
                            role="button"
                            data-type="primary"
                            aria-label="View details for {{ project.title }}"
                        >
                            View Details
                        </a>
                    </nav>
                </footer>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <div
            id="empty-state-projects"
            data-role="empty-state"
            data-state="empty"
        >
            <h2 id="heading-empty-projects">No projects found</h2>
            <p id="empty-message-projects" data-role="empty-message">
                {% if filter.is_some() %}
                No projects match your search criteria. Try adjusting your filters or search terms.
                {% else %}
                Be the first to create a project! Start collaborating with creative professionals today.
                {% endif %}
            </p>
            <nav
                id="empty-actions-projects"
                data-role="empty-state-actions"
                aria-label="Empty state actions"
            >
                {% if filter.is_some() %}
                <a
                    href="/projects"
                    id="link-clear-search"
                    role="button"
                    data-type="secondary"
                >
                    Clear Search
                </a>
                {% endif %}
                <a
                    href="/projects/new"
                    id="link-create-project"
                    role="button"
                    data-type="primary"
                >
                    Create Project
                </a>
            </nav>
        </div>
        {% endif %}
    </section>
</section>

<script>
    function updateSort(value) {
        const url = new URL(window.location);
        url.searchParams.set("sort", value);
        window.location.href = url.toString();
    }
</script>
{% endblock %}
