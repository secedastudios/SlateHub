{% extends "_layout.html" %}
{% block title %}Projects - {{ app_name }}{% endblock %}
{% block page_name %}projects{% endblock %}
{% block content %}
<section id="projects-main" data-component="projects-page">
    <header id="projects-header" data-role="page-header">
        <h1 id="heading-projects">Projects</h1>
        <p>Discover film and media projects seeking collaborators</p>
    </header>

    <section id="section-controls" data-section="controls">
        <div data-component="search-bar">
            <form id="form-search-projects" method="get" action="/projects">
                <div data-field="search">
                    <label for="input-search" hidden>Search projects</label>
                    <input
                        type="search"
                        id="input-search"
                        name="filter"
                        placeholder="Search projects..."
                        value="{% if filter.is_some() %}{{ filter.as_ref().unwrap() }}{% endif %}"
                        aria-label="Search projects"
                    />
                    <button type="submit" data-type="primary">
                        <span>Search</span>
                    </button>
                </div>
            </form>
        </div>

        <div data-component="sort-controls">
            <label for="select-sort">Sort by:</label>
            <select
                id="select-sort"
                name="sort"
                onchange="updateSort(this.value)"
                aria-label="Sort projects"
            >
                <option value="recent" {% if sort_by == "recent" %}selected{% endif %}>
                    Most Recent
                </option>
                <option value="title" {% if sort_by == "title" %}selected{% endif %}>
                    Title
                </option>
                <option value="status" {% if sort_by == "status" %}selected{% endif %}>
                    Status
                </option>
            </select>
        </div>
    </section>

    <section
        id="section-projects-list"
        data-section="projects-list"
        data-layout="grid"
        data-state="{% if projects.is_empty() %}empty{% else %}ready{% endif %}"
    >
        {% if !projects.is_empty() %}
        <div data-role="content-container">
            {% for project in projects %}
            <article
                data-component="project-card"
                data-project-id="{{ project.id }}"
                data-status="{{ project.status }}"
            >
                <header data-role="card-header">
                    <h2 id="project-title-{{ project.id }}">
                        <a href="/projects/{{ project.id }}">
                            {{ project.title }}
                        </a>
                    </h2>
                    <span
                        data-role="status-badge"
                        data-status="{{ project.status }}"
                    >
                        {{ project.status }}
                    </span>
                </header>

                <div data-role="card-body">
                    <p data-role="description">{{ project.description }}</p>

                    <div data-role="metadata">
                        <span data-field="owner">By {{ project.owner }}</span>
                        <time
                            datetime="{{ project.created_at }}"
                            data-field="created-date"
                        >
                            {{ project.created_at }}
                        </time>
                    </div>

                    {% if !project.tags.is_empty() %}
                    <div data-role="tags-list">
                        {% for tag in project.tags %}
                        <span data-role="tag" data-tag="{{ tag }}">
                            {{ tag }}
                        </span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <footer data-role="card-footer">
                    <nav data-role="card-actions">
                        <a
                            href="/projects/{{ project.id }}"
                            role="button"
                            data-type="primary"
                        >
                            View Details
                        </a>
                    </nav>
                </footer>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <div id="empty-state-projects" data-role="empty-state">
            <h2 id="heading-empty">No projects found</h2>
            {% if filter.is_some() %}
            <p>
                No projects match your search criteria. Try adjusting your
                filters.
            </p>
            {% else %}
            <p>Be the first to create a project!</p>
            {% endif %}
            <nav data-role="empty-state-actions">
                <a href="/projects/new" role="button" data-type="primary">
                    Create Project
                </a>
            </nav>
        </div>
        {% endif %}
    </section>
</section>

<script>
    function updateSort(value) {
        const url = new URL(window.location);
        url.searchParams.set("sort", value);
        window.location.href = url.toString();
    }
</script>
{% endblock %}
