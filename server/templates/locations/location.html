{% extends "_layout.html" %}
{% block title %}
    {{ location.name }}
    -
    {{ app_name }}
{% endblock %}
{% block page_name %}
    locations
{% endblock %}
{% block content %}
    <article id="location-detail" data-component="location-detail" data-location-id="{{ location.id }}" data-public="{% if location.is_public %}true{% else %}false{% endif %}">
        <header id="location-header" data-role="page-header">
            <hgroup id="location-title-group">
                <h1 id="heading-location-title">{{ location.name }}</h1>
                <p id="location-visibility" data-role="subtitle">
                    {% if location.is_public %}
                        <span id="location-public-badge" data-role="visibility-badge" data-visibility="public">Public Location</span>
                    {% else %}
                        <span id="location-private-badge" data-role="visibility-badge" data-visibility="private">Private Location</span>
                    {% endif %}
                </p>
            </hgroup>
            {% if location.can_edit %}
                <nav id="location-admin-actions" data-role="admin-actions" aria-label="Location administration">
                    <a href="/locations/{{ location.slug }}/edit" id="button-edit-location" role="button" data-type="secondary">Edit Location</a>
                    <form id="form-delete-location" action="/locations/{{ location.slug }}/delete" method="post" data-component="form" onsubmit="return confirm('Are you sure you want to delete this location?');">
                        <button type="submit" id="button-delete-location" data-type="danger">Delete Location</button>
                    </form>
                </nav>
            {% endif %}
        </header>
        <section id="section-location-info" data-section="location-info">
            <h2 id="heading-details" hidden>Location Details</h2>
            <address id="location-full-address" data-role="address">
                {{ location.address }}
                <br />
                {{ location.city }}
                ,
                {{ location.state }}
                {{ location.country }}
                {% if location.postal_code.is_some() %}
                    <br />
                    {{ location.postal_code.as_ref().unwrap() }}
                {% endif %}
            </address>
            {% if location.description.is_some() %}
                <div id="location-description-container" data-role="description-container">
                    <h3 id="heading-description">Description</h3>
                    <p id="location-description" data-role="description">{{ location.description.as_ref().unwrap() }}</p>
                </div>
            {% endif %}
            <section id="section-contact" data-section="contact">
                <h3 id="heading-contact">Contact Information</h3>
                <dl id="location-contact" data-role="contact-info">
                    <dt id="label-contact-name">Contact Person</dt>
                    <dd id="contact-name" data-field="contact-name">{{ location.contact_name }}</dd>
                    <dt id="label-contact-email">Email</dt>
                    <dd id="contact-email" data-field="contact-email">
                        <a href="mailto:{{ location.contact_email }}" id="link-contact-email">{{ location.contact_email }}</a>
                    </dd>
                    {% if location.contact_phone.is_some() %}
                        <dt id="label-contact-phone">Phone</dt>
                        <dd id="contact-phone" data-field="contact-phone">
                            <a href="tel:{{ location.contact_phone.as_ref().unwrap() }}" id="link-contact-phone">{{ location.contact_phone.as_ref().unwrap() }}</a>
                        </dd>
                    {% endif %}
                </dl>
            </section>
            {%
                if location.amenities.is_some() || location.restrictions.is_some() || location.parking_info.is_some() || location.max_capacity.is_some()
            %}
                <section id="section-facility-details" data-section="facility-details">
                    <h3 id="heading-facility">Facility Details</h3>
                    {% if location.amenities.is_some() && !location.amenities.as_ref().unwrap().is_empty() %}
                        <div id="amenities-container" data-role="amenities">
                            <h4 id="heading-amenities">Amenities</h4>
                            <ul id="amenities-list" data-role="list">
                                {% for amenity in location.amenities.as_ref().unwrap() %}
                                    <li id="amenity-{{ loop.index }}" data-role="list-item">{{ amenity }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                    {% if location.restrictions.is_some() && !location.restrictions.as_ref().unwrap().is_empty() %}
                        <div id="restrictions-container" data-role="restrictions">
                            <h4 id="heading-restrictions">Restrictions</h4>
                            <ul id="restrictions-list" data-role="list">
                                {% for restriction in location.restrictions.as_ref().unwrap() %}
                                    <li id="restriction-{{ loop.index }}" data-role="list-item">{{ restriction }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                    {% if location.parking_info.is_some() %}
                        <div id="parking-container" data-role="parking">
                            <h4 id="heading-parking">Parking Information</h4>
                            <p id="parking-info" data-role="parking-info">{{ location.parking_info.as_ref().unwrap() }}</p>
                        </div>
                    {% endif %}
                    {% if location.max_capacity.is_some() %}
                        <div id="capacity-container" data-role="capacity">
                            <h4 id="heading-capacity">Maximum Capacity</h4>
                            <p id="max-capacity" data-role="capacity-info">
                                <data value="{{ location.max_capacity.as_ref().unwrap() }}">{{ location.max_capacity.as_ref().unwrap() }} people</data>
                            </p>
                        </div>
                    {% endif %}
                </section>
            {% endif %}
            <dl id="location-metadata" data-role="metadata">
                <dt id="label-created">Listed</dt>
                <dd id="location-created" data-field="created-date">
                    <time datetime="{{ location.created_at }}">{{ location.created_at }}</time>
                </dd>
                <dt id="label-updated">Last Updated</dt>
                <dd id="location-updated" data-field="updated-date">
                    <time datetime="{{ location.updated_at }}">{{ location.updated_at }}</time>
                </dd>
            </dl>
        </section>
        <section id="section-location-rates" data-section="location-rates">
            <header id="rates-header" data-role="section-header">
                <h2 id="heading-rates">Rental Rates</h2>
                {% if location.can_edit %}
                    <button type="button" id="button-add-rate" data-type="primary" onclick="showAddRateForm()">Add Rate</button>
                {% endif %}
            </header>
            {% if location.can_edit %}
                <div id="add-rate-form-container" data-component="add-rate-form" data-state="hidden" hidden>
                    <form id="form-add-rate" action="/locations/{{ location.slug }}/rates/add" method="post" data-component="form">
                        <fieldset id="fieldset-add-rate" data-role="form-section">
                            <legend>Add Rental Rate</legend>
                            <div id="field-rate-type" data-field="rate-type">
                                <label for="select-rate-type">Rate Type</label>
                                <select id="select-rate-type" name="rate_type" required>
                                    <option value="">-- Select Type --</option>
                                    <option value="hourly">Hourly</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            <div id="field-amount" data-field="amount">
                                <label for="input-amount">Amount</label>
                                <input type="number" id="input-amount" name="amount" step="0.01" min="0" required
                               placeholder="1000.00" aria-describedby="help-amount">
                                <small id="help-amount" data-role="help-text">Enter the rate amount in your currency</small>
                            </div>
                            <div id="field-currency" data-field="currency">
                                <label for="input-currency">Currency</label>
                                <input type="text" id="input-currency" name="currency" value="USD" maxlength="3"
                               placeholder="USD" aria-describedby="help-currency">
                                <small id="help-currency" data-role="help-text">
                                    3-letter currency code (e.g., USD, EUR, GBP)
                                </small>
                            </div>
                            <div id="field-minimum" data-field="minimum">
                                <label for="input-minimum">Minimum Duration</label>
                                <input type="number" id="input-minimum" name="minimum_duration" min="1"
                               placeholder="e.g., 4 for 4 hours minimum" aria-describedby="help-minimum">
                                <small id="help-minimum" data-role="help-text">
                                    Minimum number of hours/days/weeks/months required
                                </small>
                            </div>
                            <div id="field-rate-description" data-field="rate-description">
                                <label for="input-rate-description">Description</label>
                                <input type="text" id="input-rate-description" name="description"
                               placeholder="e.g., Includes lighting and power" aria-describedby="help-rate-description">
                                <small id="help-rate-description" data-role="help-text">
                                    Optional details about what's included in this rate
                                </small>
                            </div>
                            <div id="add-rate-actions" data-role="form-actions">
                                <button type="button" id="button-cancel-rate" data-type="secondary" onclick="hideAddRateForm()">Cancel</button>
                                <button type="submit" id="button-submit-rate" data-type="primary">Add Rate</button>
                            </div>
                        </fieldset>
                    </form>
                </div>
            {% endif %}
            <div id="rates-list" data-component="rates-list" data-layout="table">
                {% if !location.rates.is_empty() %}
                    <table id="location-rates-table" data-role="rates-table">
                        <thead>
                            <tr>
                                <th id="header-type">Type</th>
                                <th id="header-amount">Amount</th>
                                <th id="header-minimum">Minimum</th>
                                <th id="header-description">Description</th>
                                {% if location.can_edit %}
                                    <th id="header-actions">Actions</th>
                                {% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for rate in location.rates %}
                                <tr id="rate-{{ rate.id }}" data-component="rate-row" data-rate-type="{{ rate.rate_type }}">
                                    <td data-field="rate-type">{{ rate.rate_type }}</td>
                                    <td data-field="amount">
                                        <data value="{{ rate.amount }}">
                                            {{ rate.currency }}
                                            {{ rate.amount }}
                                        </data>
                                    </td>
                                    <td data-field="minimum">
                                        {% if rate.minimum_duration.is_some() %}
                                            {{ rate.minimum_duration.as_ref().unwrap() }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td data-field="description">
                                        {% if rate.description.is_some() %}
                                            {{ rate.description.as_ref().unwrap() }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    {% if location.can_edit %}
                                        <td data-field="actions">
                                            <form id="form-delete-rate-{{ rate.id }}"
                                  action="/locations/{{ location.slug }}/rates/{{ rate.id }}/delete"
                                  method="post"
                                  data-component="form"
                                  data-role="delete-rate-form">
                                                <button type="submit"
                                        id="button-delete-rate-{{ rate.id }}"
                                        data-type="danger-subtle"
                                        onclick="return confirm('Delete this rate?');">Delete</button>
                                            </form>
                                        </td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div id="empty-state-rates" data-role="empty-state">
                        <p id="empty-message-rates" data-role="empty-message">
                            No rental rates have been added for this location yet.
                        </p>
                        {% if location.can_edit %}
                            <nav id="empty-actions-rates" data-role="empty-state-actions">
                                <button type="button" id="button-add-first-rate" data-type="primary" onclick="showAddRateForm()">Add First Rate</button>
                            </nav>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </section>
        <footer id="location-footer" data-role="page-footer">
            <nav id="location-nav-actions" data-role="footer-navigation" aria-label="Location navigation">
                <a href="/locations" id="link-back-to-locations" role="button" data-type="secondary">← Back to Locations</a>
            </nav>
        </footer>
    </article>
    <script>
    function showAddRateForm() {
        const container = document.getElementById('add-rate-form-container');
        if (container) {
            container.removeAttribute('hidden');
            container.setAttribute('data-state', 'visible');
            document.getElementById('select-rate-type').focus();
        }
    }

    function hideAddRateForm() {
        const container = document.getElementById('add-rate-form-container');
        if (container) {
            container.setAttribute('hidden', '');
            container.setAttribute('data-state', 'hidden');
            document.getElementById('form-add-rate').reset();
        }
    }
</script>
{% endblock %}
