{% extends "_layout.html" %}
{% block title %}Edit {{ production.title }} - {{ app_name }}{% endblock %}
{% block page_name %}productions{% endblock %}
{% block content %}
<section id="section-production-edit" data-component="production-form" data-type="edit">
    <header id="production-edit-header" data-role="page-header">
        <h1 id="heading-edit-production">Edit Production</h1>
        <p data-role="subtitle">
            Update the details for {{ production.title }}
        </p>
    </header>

    {% if errors.is_some() %}
    <div id="form-errors" role="alert" data-component="error-list" data-state="error">
        <h2 id="heading-errors">Please correct the following errors:</h2>
        <ul id="error-list" data-role="error-messages">
            {% for error in errors.as_ref().unwrap() %}
            <li id="error-{{ loop.index }}" data-role="error-item">{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <form id="form-edit-production" method="post" action="/productions/{{ production.slug }}/edit" data-component="form">
        <fieldset id="fieldset-basic-info" data-role="form-section">
            <legend>Basic Information</legend>

            <div id="field-title" data-field="title">
                <label for="input-title">
                    Production Title
                </label>
                <input
                    type="text"
                    id="input-title"
                    name="title"
                    value="{{ production.title }}"
                    aria-describedby="help-title"
                    placeholder="Enter the production title"
                />
                <small id="help-title" data-role="help-text">
                    Choose a clear, descriptive title for your production
                </small>
            </div>

            <div id="field-production-type" data-field="production-type">
                <label for="select-production-type">
                    Production Type
                </label>
                <select
                    id="select-production-type"
                    name="production_type"
                    aria-describedby="help-production-type"
                >
                    <option value="">-- Select Type --</option>
                    {% for prod_type in production_types %}
                    <option value="{{ prod_type }}" {% if production.production_type.as_str() == prod_type %}selected{% endif %}>
                        {{ prod_type }}
                    </option>
                    {% endfor %}
                </select>
                <small id="help-production-type" data-role="help-text">
                    Select the type that best describes your production
                </small>
            </div>

            <div id="field-status" data-field="status">
                <label for="select-status">
                    Production Status
                </label>
                <select
                    id="select-status"
                    name="status"
                    aria-describedby="help-status"
                >
                    <option value="">-- Select Status --</option>
                    {% for status in production_statuses %}
                    <option value="{{ status }}" {% if production.status.as_str() == status %}selected{% endif %}>
                        {{ status }}
                    </option>
                    {% endfor %}
                </select>
                <small id="help-status" data-role="help-text">
                    Current phase of the production
                </small>
            </div>
        </fieldset>

        <fieldset id="fieldset-details" data-role="form-section">
            <legend>Production Details</legend>

            <div id="field-description" data-field="description">
                <label for="textarea-description">
                    Description
                </label>
                <textarea
                    id="textarea-description"
                    name="description"
                    rows="6"
                    aria-describedby="help-description"
                    placeholder="Describe your production, its goals, and what makes it unique..."
                >{% if production.description.is_some() %}{{ production.description.as_ref().unwrap() }}{% endif %}</textarea>
                <small id="help-description" data-role="help-text">
                    Provide details about the production to attract the right collaborators
                </small>
            </div>

            <div id="field-location" data-field="location">
                <label for="input-location">
                    Location
                </label>
                <input
                    type="text"
                    id="input-location"
                    name="location"
                    value="{% if production.location.is_some() %}{{ production.location.as_ref().unwrap() }}{% endif %}"
                    aria-describedby="help-location"
                    placeholder="e.g., Los Angeles, CA"
                />
                <small id="help-location" data-role="help-text">
                    Primary filming or production location
                </small>
            </div>
        </fieldset>

        <fieldset id="fieldset-schedule" data-role="form-section">
            <legend>Schedule</legend>

            <div id="field-start-date" data-field="start-date">
                <label for="input-start-date">
                    Start Date
                </label>
                <input
                    type="date"
                    id="input-start-date"
                    name="start_date"
                    value="{% if production.start_date.is_some() %}{{ production.start_date.as_ref().unwrap() }}{% endif %}"
                    aria-describedby="help-start-date"
                />
                <small id="help-start-date" data-role="help-text">
                    When production is expected to begin
                </small>
            </div>

            <div id="field-end-date" data-field="end-date">
                <label for="input-end-date">
                    End Date
                </label>
                <input
                    type="date"
                    id="input-end-date"
                    name="end_date"
                    value="{% if production.end_date.is_some() %}{{ production.end_date.as_ref().unwrap() }}{% endif %}"
                    aria-describedby="help-end-date"
                />
                <small id="help-end-date" data-role="help-text">
                    Expected completion date
                </small>
            </div>
        </fieldset>

        <div id="form-actions" data-role="form-actions">
            <a
                href="/productions/{{ production.slug }}"
                id="button-cancel"
                role="button"
                data-type="secondary"
            >
                Cancel
            </a>
            <button
                type="submit"
                id="button-submit-changes"
                data-type="primary"
            >
                Save Changes
            </button>
        </div>
    </form>

    <section id="section-danger-zone" data-section="danger-zone" data-state="danger">
        <header id="danger-zone-header" data-role="section-header">
            <h2 id="heading-danger-zone">Danger Zone</h2>
        </header>

        <div id="delete-production-container" data-component="danger-action">
            <div id="delete-warning" data-role="warning-text">
                <h3 id="heading-delete-production">Delete Production</h3>
                <p id="delete-description" data-role="warning-description">
                    Once you delete a production, there is no going back. This will permanently delete the production
                    and remove all associations with team members.
                </p>
            </div>
            <form
                id="form-delete-production"
                action="/productions/{{ production.slug }}/delete"
                method="post"
                data-component="form"
                onsubmit="return confirmDelete();"
            >
                <button
                    type="submit"
                    id="button-delete-production"
                    data-type="danger"
                >
                    Delete This Production
                </button>
            </form>
        </div>
    </section>
</section>

<script>
    // Auto-validate dates
    document.getElementById('input-end-date').addEventListener('change', function() {
        const startDate = document.getElementById('input-start-date').value;
        const endDate = this.value;

        if (startDate && endDate && endDate < startDate) {
            this.setCustomValidity('End date must be after start date');
            this.reportValidity();
        } else {
            this.setCustomValidity('');
        }
    });

    document.getElementById('input-start-date').addEventListener('change', function() {
        const endDate = document.getElementById('input-end-date').value;
        const startDate = this.value;

        if (startDate && endDate && endDate < startDate) {
            document.getElementById('input-end-date').setCustomValidity('End date must be after start date');
        } else {
            document.getElementById('input-end-date').setCustomValidity('');
        }
    });

    function confirmDelete() {
        return confirm('Are you sure you want to delete this production? This action cannot be undone.');
    }
</script>
{% endblock %}
